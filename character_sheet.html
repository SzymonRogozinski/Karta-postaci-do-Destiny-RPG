<!--Parametr obsługujący strony-->
<input type="hidden" class="sheet-tabstoggle" name="attr_sheetTab" value="main" />
<div class="sheet_selector">
    <button type="action" name="act_main">Główna strona</button>
    <button type="action" name="act_equipment">Ekwipunek</button>
    <button type="action" name="act_details">Szczegóły</button>
</div>
<!--Strona główna-->
<div class='sheet-main'>
    <!--Pierwsza kolumna-->
    <div class="sheet-col">
        <!--Postać po krótce-->
        <div id="General_description" class="sector">
            <div class="sub_sector">
                Imię: <input class="input_long" type="text" name="attr_name">

                Płeć:<select class="short_select" name="attr_gender">
                    <option value="-">-</option>
                    <option value="K">K</option>
                    <option value="M">M</option>
                </select>
            </div>

            <div class="sub_sector">
                Rasa:<select class="text_select" name="attr_race">
                    <option value="-">-</option>
                    <option value="Człowiek">Człowiek</option>
                    <option value="Exo">Exo</option>
                    <option value="Przebudzony">Przebudzony</option>
                </select><br>
            </div>

            <div class="sub_sector">
                Klasa:<select class="text_select" name="attr_class">
                    <option value="-">-</option>
                    <option value="Tytan">Tytan</option>
                    <option value="Łowca">Łowca</option>
                    <option value="Czarownik">Czarownik</option>
                </select><br>
            </div>

            <div class="sub_sector">
                Podklasa:<select class="text_select" id="subclass_list" name="attr_subclass">
                    <option value="-">-</option>
                    <option disabled style="background-color: black; color: white; font-weight: bold;">---Tytan---</option>
                    <option value="Słoneczny pogromca">Słoneczny pogromca</option>
                    <option value="Szturmowiec">Szturmowiec</option>
                    <option value="Wartownik">Wartownik</option>
                    <option disabled style="background-color: black; color: white; font-weight: bold;">---Łowca---</option>
                    <option value="Strzelec">Strzelec</option>
                    <option value="Gromodzierżca">Gromodzierżca</option>
                    <option value="Tropiciel">Tropiciel</option>
                    <option disabled style="background-color: black; color: white; font-weight: bold;">---Czarownik---</option>
                    <option value="Ostrze świtu">Ostrze świtu</option>
                    <option value="Kroczący przez próżnię">Kroczący przez próżnię</option>
                    <option value="Siewca burz">Siewca burz</option>
                </select><br>
            </div>

            <div class="sub_sector">
                Ranga:<input class="input_long" type="text" name="attr_rank" value="-" readonly><br>
            </div>

            <div class="sub_sector">
                Poziom:<input class="input_short" type="text" name="attr_level" value="0" readonly><br>

                PD:<input class="input_short" type="text" name="attr_EXP_To_Next_Level" value="0" readonly><br>
            </div>
        </div>

        <div id="Skills" class="sector">
            <h3>Umiejętności</h3>

            <h6>Spryt</h6>
            <div class="sub_sector">
                Hazard [Spryt]<select class="short_select" name="attr_gamble" value="-">
                    <option value="-">-</option>
                    <option value="d4">k4</option>
                    <option value="d6">k6</option>
                    <option value="d8">k8</option>
                    <option value="d10">k10</option>
                    <option value="d12">k12</option>
                </select>
                <input type="hidden" name="attr_gamble_mod" value="0">
                <button type="action" class="roll_button" name="act_roll_gamble"></button><br>
            </div>
            <div class="sub_sector">
                Przetrwanie [Spryt]<select class="short_select" name="attr_survival" value="-">
                    <option value="-">-</option>
                    <option value="d4">k4</option>
                    <option value="d6">k6</option>
                    <option value="d8">k8</option>
                    <option value="d10">k10</option>
                    <option value="d12">k12</option>
                </select>
                <input type="hidden" name="attr_survival_mod" value="0">
                <button type="action" class="roll_button" name="act_roll_survival"></button><br>
            </div>
            <div class="sub_sector">
                Reperowanie [Spryt]<select class="short_select" name="attr_repair" value="-">
                    <option value="-">-</option>
                    <option value="d4">k4</option>
                    <option value="d6">k6</option>
                    <option value="d8">k8</option>
                    <option value="d10">k10</option>
                    <option value="d12">k12</option>
                </select>
                <input type="hidden" name="attr_repair_mod" value="0">
                <button type="action" class="roll_button" name="act_roll_repair"></button><br>
            </div>
            <div class="sub_sector">
                Spostrzegawczość [Spryt]<select class="short_select" name="attr_spot" value="-">
                    <option value="-">-</option>
                    <option value="d4">k4</option>
                    <option value="d6">k6</option>
                    <option value="d8">k8</option>
                    <option value="d10">k10</option>
                    <option value="d12">k12</option>
                </select>
                <input type="hidden" name="attr_spot_mod" value="0">
                <button type="action" class="roll_button" name="act_roll_spot"></button><br>
            </div>
            <div class="sub_sector">
                Tropienie [Spryt]<select class="short_select" name="attr_tracking" value="-">
                    <option value="-">-</option>
                    <option value="d4">k4</option>
                    <option value="d6">k6</option>
                    <option value="d8">k8</option>
                    <option value="d10">k10</option>
                    <option value="d12">k12</option>
                </select>
                <input type="hidden" name="attr_tracking_mod" value="0">
                <button type="action" class="roll_button" name="act_roll_tracking"></button><br>
            </div>
            <div class="sub_sector">
                Wyszukiwanie [Spryt]<select class="short_select" name="attr_search" value="-">
                    <option value="-">-</option>
                    <option value="d4">k4</option>
                    <option value="d6">k6</option>
                    <option value="d8">k8</option>
                    <option value="d10">k10</option>
                    <option value="d12">k12</option>
                </select>
                <input type="hidden" name="attr_search_mod" value="0">
                <button type="action" class="roll_button" name="act_roll_search"></button><br>
            </div>
            <div class="sub_sector">
                Wyśmiewanie [Spryt]<select class="short_select" name="attr_ridicule" value="-">
                    <option value="-">-</option>
                    <option value="d4">k4</option>
                    <option value="d6">k6</option>
                    <option value="d8">k8</option>
                    <option value="d10">k10</option>
                    <option value="d12">k12</option>
                </select>
                <input type="hidden" name="attr_ridicule_mod" value="0">
                <button type="action" class="roll_button" name="act_roll_ridicule"></button><br>
            </div>
            <h6>Zręczność</h6>
            <div class="sub_sector">
                Pilotowanie [Zręczność]<select class="short_select" name="attr_pilotage" value="-">
                    <option value="-">-</option>
                    <option value="d4">k4</option>
                    <option value="d6">k6</option>
                    <option value="d8">k8</option>
                    <option value="d10">k10</option>
                    <option value="d12">k12</option>
                </select>
                <input type="hidden" name="attr_pilotage_mod" value="0">
                <button type="action" class="roll_button" name="act_roll_pilotage"></button><br>
            </div>
            <div class="sub_sector">
                Prowadzenie [Zręczność]<select class="short_select" name="attr_drive" value="-">
                    <option value="-">-</option>
                    <option value="d4">k4</option>
                    <option value="d6">k6</option>
                    <option value="d8">k8</option>
                    <option value="d10">k10</option>
                    <option value="d12">k12</option>
                </select>
                <input type="hidden" name="attr_drive_mod" value="0">
                <button type="action" class="roll_button" name="act_roll_drive"></button><br>
            </div>
            <div class="sub_sector">
                Ruch [Zręczność]<select class="short_select" name="attr_move" value="d4">
                    <option value="d4">k4</option>
                    <option value="d6">k6</option>
                    <option value="d8">k8</option>
                    <option value="d10">k10</option>
                    <option value="d12">k12</option>
                </select>
                <input type="hidden" name="attr_move_mod" value="0">
                <button type="action" class="roll_button" name="act_roll_move"></button><br>
            </div>
            <div class="sub_sector">
                Rzucanie [Zręczność]<select class="short_select" name="attr_throw" value="-">
                    <option value="-">-</option>
                    <option value="d4">k4</option>
                    <option value="d6">k6</option>
                    <option value="d8">k8</option>
                    <option value="d10">k10</option>
                    <option value="d12">k12</option>
                </select>
                <input type="hidden" name="attr_throw_mod" value="0">
                <button type="action" class="roll_button" name="act_roll_throw"></button><br>
            </div>
            <div class="sub_sector">
                Skradanie się [Zręczność]<select class="short_select" name="attr_stealth" value="-">
                    <option value="-">-</option>
                    <option value="d4">k4</option>
                    <option value="d6">k6</option>
                    <option value="d8">k8</option>
                    <option value="d10">k10</option>
                    <option value="d12">k12</option>
                </select>
                <input type="hidden" name="attr_stealth_mod" value="0">
                <button type="action" class="roll_button" name="act_roll_stealth"></button><br>
            </div>
            <div class="sub_sector">
                Strzelanie [Zręczność]<select class="short_select" name="attr_shoot" value="d4">
                    <option value="d4">k4</option>
                    <option value="d6">k6</option>
                    <option value="d8">k8</option>
                    <option value="d10">k10</option>
                    <option value="d12">k12</option>
                </select>
                <input type="hidden" name="attr_shoot_mod" value="0">
                <button type="action" class="roll_button" name="act_roll_shoot"></button><br>
            </div>
            <div class="sub_sector">
                Walka wręcz [Zręczność]<select class="short_select" name="attr_brawl" value="d4">
                    <option value="d4">k4</option>
                    <option value="d6">k6</option>
                    <option value="d8">k8</option>
                    <option value="d10">k10</option>
                    <option value="d12">k12</option>
                </select>
                <input type="hidden" name="attr_brawl_mod" value="0">
                <button type="action" class="roll_button" name="act_roll_brawl"></button><br>
            </div>
            <div class="sub_sector">
                Włamywanie się [Zręczność]<select class="short_select" name="attr_breaking" value="-">
                    <option value="-">-</option>
                    <option value="d4">k4</option>
                    <option value="d6">k6</option>
                    <option value="d8">k8</option>
                    <option value="d10">k10</option>
                    <option value="d12">k12</option>
                </select>
                <input type="hidden" name="attr_breaking_mod" value="0">
                <button type="action" class="roll_button" name="act_roll_breaking"></button><br>
            </div>
            <h6>Duch</h6>
            <div class="sub_sector">
                Przekonywanie [Duch]<select class="short_select" name="attr_persuade" value="-">
                    <option value="-">-</option>
                    <option value="d4">k4</option>
                    <option value="d6">k6</option>
                    <option value="d8">k8</option>
                    <option value="d10">k10</option>
                    <option value="d12">k12</option>
                </select>
                <input type="hidden" name="attr_persuade_mod" value="0">
                <button type="action" class="roll_button" name="act_roll_persuade"></button><br>
            </div>
            <div class="sub_sector">
                Zastraszanie [Duch]<select class="short_select" name="attr_intimidate" value="-">
                    <option value="-">-</option>
                    <option value="d4">k4</option>
                    <option value="d6">k6</option>
                    <option value="d8">k8</option>
                    <option value="d10">k10</option>
                    <option value="d12">k12</option>
                </select>
                <input type="hidden" name="attr_intimidate_mod" value="0">
                <button type="action" class="roll_button" name="act_roll_intimidate"></button><br>
            </div>

            <h6>Dodatkowe</h6>
            <div class="sub_sector">
                <div>
                    <fieldset class="repeating_newskill">
                        <input class="input_long" type="text" name="attr_nsname">
                        <select class="short_select" name="attr_nsvalue" value="-">
                            <option value="-">-</option>
                            <option value="d4">k4</option>
                            <option value="d6">k6</option>
                            <option value="d8">k8</option>
                            <option value="d10">k10</option>
                            <option value="d12">k12</option>
                        </select>
                        <input type="hidden" name="attr_nsvaluemod" value="0">
                        <button type="action" class="roll_button" name="act_rollns"></button>
                    </fieldset>
                </div>
            </div>
        </div>
    </div><!--Druga kolumna-->
    <div class="sheet-col">
        <!--Cechy postaci-->
        <div id="Atributes" class="sector">
            <h3>Cechy</h3>
            <div class="sub_sector">
                Siła<select class="short_select" name="attr_strength" value="d4">
                    <option value="d4">k4</option>
                    <option value="d6">k6</option>
                    <option value="d8">k8</option>
                    <option value="d10">k10</option>
                    <option value="d12">k12</option>
                </select>
                <input type="hidden" name="attr_strength_mod" value="0">
                <button type="action" class="roll_button" name="act_roll_strength"></button><br>

                Zręczność<select class="short_select" name="attr_agility" value="d4">
                    <option value="d4">k4</option>
                    <option value="d6">k6</option>
                    <option value="d8">k8</option>
                    <option value="d10">k10</option>
                    <option value="d12">k12</option>
                </select>
                <input type="hidden" name="attr_agility_mod" value="0">
                <button type="action" class="roll_button" name="act_roll_agility"></button><br>
            </div>
            <div class="sub_sector">
                Spryt<select class="short_select" name="attr_smart" value="d4">
                    <option value="d4">k4</option>
                    <option value="d6">k6</option>
                    <option value="d8">k8</option>
                    <option value="d10">k10</option>
                    <option value="d12">k12</option>
                </select>
                <input type="hidden" name="attr_smart_mod" value="0">
                <button type="action" class="roll_button" name="act_roll_smart"></button><br>

                Duch<select class="short_select" name="attr_spirit" value="d4">
                    <option value="d4">k4</option>
                    <option value="d6">k6</option>
                    <option value="d8">k8</option>
                    <option value="d10">k10</option>
                    <option value="d12">k12</option>
                </select>
                <input type="hidden" name="attr_spirit_mod" value="0">
                <button type="action" class="roll_button" name="act_roll_spirit"></button><br>
            </div>
            <div class="vig_sub_sector">
                Wigor<select class="vig_select" name="attr_vigor" value="d4">
                    <option value="d4">k4</option>
                    <option value="d6">k6</option>
                    <option value="d8">k8</option>
                    <option value="d10">k10</option>
                    <option value="d12">k12</option>
                </select>
                <input type="hidden" class="roll_button" name="attr_vigor_mod" value="0">
                <button type="action" class="roll_button" name="act_roll_vigor"></button><br>
            </div>
            <!--Cechy pochodne-->
            <div class="sub_sector">
                Obrona:<input class="input_short" type="text" name="attr_parry" value="2" readonly><br>
                <input type="hidden" name="attr_parry_mod" value="0">

                Wytrzymałość:<input class="input_short" type="text" name="attr_tough" value="2" readonly><br>
                <input type="hidden" name="attr_tough_mod" value="0">
            </div>
            <div class="sub_sector">
                Charyzma:<input class="input_short" type="text" name="attr_charisma" value="0" readonly><br>

                Tempo:<input class="input_short" type="text" name="attr_speed" value="6" readonly><br>
            </div>
            <div class="sub_sector">
                Fuksy:<input type="number" name="attr_luck" value="3"><br>
                <input type="hidden" name="attr_luck_max" value="3">

                Rozmiar:<input class="input_short" type="text" name="attr_size" value="0" readonly><br>
            </div>
        </div>

        <!--Przewagi-->
        <div id="Advances" class="sector">
            <h3>Przewagi</h3>
            <div class="sub_sector">
                <div>
                    <fieldset class="repeating_advantage">
                        Nazwa<input type="text" name="attr_advname"><br>
                        Wymagania<input type="text" name="attr_advreq"><br>
                        <details>
                            Opis<br><textarea class="extending_desc" name="attr_advdiscDetails"></textarea>
                        </details>
                    </fieldset>
                </div>
            </div>
        </div>

        <!--Zawady-->
        <div id="Edges" class="sector">
            <h3>Zawady</h3>
            <div class="sub_sector">
                <div>
                    <fieldset class="repeating_edges">
                        Nazwa<input type="text" name="attr_edgname"><br>
                        Stopień<input type="text" name="attr_edgstr"><br>
                        <details>
                            Opis<br><textarea name="attr_edgDetails"></textarea>
                        </details>
                    </fieldset>
                </div>
            </div>
        </div>
    </div><!--Trzecia kolumna-->
    <div class='sheet-col'>
        <div id="resource" class="sector">
            <h3>Zasoby:</h3>
            <div class="sub_sector">
                Punkty światła<input type="number" name="attr_light_point" min="0" max="10" value="0" /><br>
            </div>
            <h4>Amunicja</h4>
            <div class="sub_sector">
                <p style="color:#aeaeae;" id="amno_k"><b>Kinetyczna</b></p><input type="number" name="attr_kinetic_amno"
                    min="0" max="10" value="0" /><br>
            </div>
            <div class="sub_sector">
                <p style="color:#3bff4f;" id="amno_s"><b>Specjalna</b></p><input type="number" name="attr_special_amno"
                    min="0" max="10" value="0" /><br>
            </div>
            <div class="sub_sector">
                <p style="color:#b300ff;" id="amno_h"><b>Ciężka</b></p><input type="number" name="attr_heavy_amno"
                    min="0" max="5" value="0" /><br>
            </div>
        </div>
    </div>
</div>
<!--Strona ekwipunku-->
<div class="sheet-equipment">
    <!--Ekwipunek ogólny-->
    <div class="sector">
        <h3>Ekwipunek</h3>
        <textarea class="big_textfield" name="attr_general_eq"></textarea>
    </div>
    <!--Waluty-->
    <div class="sector">
        <h3>Waluty</h3>
        <div class="sub_sector">
            Migot <input class="long_number" type="number" name="attr_glimmer" min="0" max="100000000"><br>
        </div>
        <div class="sub_sector">
            Legendarne odłamki <input class="short_number" type="number" name="attr_legendary_shards" min="0"
                max="100"><br>
        </div>
        <div class="sub_sector">
            Dziwne monety <input class="short_number" type="number" name="attr_strange_coins" min="0" max="100">
        </div>
    </div>
    <!--Karta broni-->
    <div class="sector">
        <!--Wyciągnięcie zmiennej, aby mogła zmieniać tło-->
        <input name="attr_weapon_quality" type="hidden" class="sheet-weapon-quality-switch">
        <div class="sheet-weapon-card">
            <div class="left_part">
                <!--Nazwa-->
                <div class="param">
                    <input class="param_long" type="text" name="attr_weapon_name" value="">
                </div>
                <div class="param">
                    <!--Typ broni-->
                    <select class="select_long" name="attr_type" value="-">
                        <option value="">-</option>

                        <option disabled style="background-color: black; color: white; font-weight: bold;">---Broń zwykła---</option>
                        <option value="Hand_cannon">Rewolwer</option>
                        <option value="Auto_rifle">Karabin automatyczny</option>
                        <option value="Scout_rifle">Karabin zwiadowczy</option>
                        <option value="Pulse_rifle">Karabin pulsacyjny</option>
                        <option value="Sidearm">Broń boczna</option>
                        <option value="Smg">Pistolet maszynowy</option>
                        <option value="Bow">Łuk</option>

                        <option disabled style="background-color: black; color: white; font-weight: bold;">---Broń specjalna---</option>
                        <option value="Shotgun">Strzelba</option>
                        <option value="Sniper_rifle">Karabin snajperski</option>
                        <option value="Fusion_rifle">Karabin fuzyjny</option>
                        <option value="Light_grnd">Lekki Granatnik</option>

                        <option disabled style="background-color: black; color: white; font-weight: bold;">---Broń ciężka---</option>
                        <option value="Machine_rifle">Karabin maszynowy</option>
                        <option value="Line_rifle">Karabin liniowy</option>
                        <option value="Rocket_launcher">Wyrzutnia rakiet</option>
                        <option value="Granade_launcher">Granatnik</option>
                        <option value="Sword">Miecz</option>
                    </select>
                </div>
                <!--Parametry broni-->
                <div class="param">
                    <input class="readonly_input" type="text" name="attr_param_name_1" readonly>
                    <input class="param" type="text" name="attr_param1">
                </div>
                <div class="param">
                    <input class="readonly_input" type="text" name="attr_param_name_2" readonly>
                    <input class="param" type="text" name="attr_param2">
                </div>
                <div class="param">
                    <input class="readonly_input" type="text" name="attr_param_name_3" readonly>
                    <input class="param" type="text" name="attr_param3">
                </div>
                <div class="param">
                    <input class="readonly_input" type="text" name="attr_param_name_4" readonly>
                    <input class="param" type="text" name="attr_param4">
                </div>
                <div class="param">
                    <input class="readonly_input" type="text" name="attr_param_name_5" readonly>
                    <input class="param" type="text" name="attr_param5">
                </div>
                <div class="param">
                    <input class="readonly_input" type="text" name="attr_param_name_6" readonly>
                    <input class="param" type="text" name="attr_param6">
                </div>
                <div class="param">
                    <input class="readonly_input" type="text" name="attr_param_name_7" readonly>
                    <input class="param" type="text" name="attr_param7">
                </div>
                <div class="param">
                    <input class="readonly_input" type="text" value="Strzały" readonly>
                    <input class="param" type="number" name="attr_weapon_current_ammo" min="0">
                </div>
                <!--Wybór typu amunicji-->
                <div class="param">
                    <!--Wyciągnięcie zmiennej, aby mogła zmieniać kolor czcionki-->
                    <input name="attr_weapon_amno" type="hidden" class="sheet-amno-switch">
                    <input class="readonly_input" type="text" value="Amunicja" readonly>
                    <select class="sheet-amno-select" name="attr_weapon_amno" value="-">
                        <option value="-">-</option>
                        <option style="color:#aeaeae;" value="kinetic_amno">Kinetyczna</option>
                        <option style="color:#3bff4f;" value="special_amno">Specjalna</option>
                        <option style="color:#b300ff;" value="heavy_amno">Ciężka</option>
                    </select>
                </div>
                <!--Wybór jakości-->
                <div class="param">
                    <input class="readonly_input" type="text" value="Rzadkość" readonly>
                    <select class="sheet-quality-select" name="attr_weapon_quality" value="-">
                        <option value="-">-</option>
                        <option value="common">Zwykła</option>
                        <option value="uncommon">Niezwykła</option>
                        <option value="rare">Rzadka</option>
                        <option value="legend">Legendarna</option>
                        <option value="exotic">Egzotyczna</option>
                    </select>
                </div>
            </div>
            <!--Wybór typu obrażeń-->
            <div class="right_part">
                <div class="param">
                    <input class="readonly_input" type="text" value="Żywioł" readonly>
                    <select name="attr_weapon_energy">
                        <option value="">-</option>
                        <option value="kinetic">Kinetyczny</option>
                        <option value="arc">Arc</option>
                        <option value="void">Próżniowy</option>
                        <option value="solar">Solarny</option>
                    </select>
                </div>
                <!--Wyciągnięcie zmiennej, aby mogła wyświetlać odpowiednią liczbę modyfikacji-->
                <input name="attr_weapon_quality" type="hidden" class="sheet-block-mod-switch">
                <!--Modyfikacja broni jeden-->
                <div class="block_mod_1">
                    <input class="block_name" type="text" name="attr_weapons_mod_name_1">
                    <textarea class="small_ta" name="attr_weapons_mod_desc_1"></textarea>
                </div>
                <!--Modyfikacja broni dwa-->
                <div class="block_mod_2">
                    <input class="block_name" type="text" name="attr_weapons_mod_name_2">
                    <textarea class="small_ta" name="attr_weapons_mod_desc_2"></textarea>
                </div>
            </div>
        </div>
        <!--Przyciski funkcyjne-->
        <div class="sub_sector">
            <button type="action" name="act_reload">Przeładuj</button>
            <button type="action" name="act_attack">Atakuj</button>
        </div>
    </div>
    <!--Karta pancerza-->
    <div class="sector">
        <!--Wyciągnięcie zmiennej, aby mogła zmieniać kolor tła-->
        <input name="attr_armor_quality" type="hidden" class="sheet-armor-quality-switch">
        <div class="sheet-armor-card">
            <div class="left_part">
                <!--Parametry pancerza-->
                <div class="param">
                    <input class="param_long" type="text" name="attr_armor_name" value="">
                </div>
                <div class="param">
                    <input class="readonly_input" type="text" value="Mobilność" readonly>
                    <input class="param" type="text" value="0" name="attr_armor_mobility">
                </div>
                <div class="param">
                    <input class="readonly_input" type="text" value="Defensywa" readonly>
                    <input class="param" type="text" value="0" name="attr_armor_defence">
                </div>
                <div class="param">
                    <input class="readonly_input" type="text" value="Regeneracja" readonly>
                    <input class="param" type="text" value="0" name="attr_armor_regeneration">
                </div>
                <div class="param">
                    <input class="readonly_input" type="text" value="Dyscyplina" readonly>
                    <input class="param" type="text" value="0" name="attr_armor_discipline">
                </div>
                <div class="param">
                    <input class="readonly_input" type="text" value="Inteligencja" readonly>
                    <input class="param" type="text" value="0" name="attr_armor_inteligence">
                </div>
                <div class="param">
                    <input class="readonly_input" type="text" value="Krzepa" readonly>
                    <input class="param" type="text" value="0" name="attr_armor_strong">
                </div>
                <div class="param">
                    <input class="readonly_input" type="text" value="Pancerz" readonly>
                    <input class="param" type="text" value="0" name="attr_armor_value">
                </div>
                <!--Klasa postaci, dla jakiej przeznaczony jest pancerz-->
                <div class="param">
                    <input class="readonly_input" type="text" value="Klasa" readonly>
                    <select class="sheet-amno-select" name="attr_armor_class" value="-">
                        <option value="-">-</option>
                        <option value="titan">Tytan</option>
                        <option value="hunter">Łowca</option>
                        <option value="warlock">Czarownik</option>
                    </select>
                </div>
                <!--Rzadkość pancerza-->
                <div class="param">
                    <input class="readonly_input" type="text" value="Rzadkość" readonly>
                    <select class="sheet-quality-select" name="attr_armor_quality" value="-">
                        <option value="-">-</option>
                        <option value="common">Zwykła</option>
                        <option value="uncommon">Niezwykła</option>
                        <option value="rare">Rzadka</option>
                        <option value="legend">Legendarna</option>
                        <option value="exotic">Egzotyczna</option>
                    </select>
                </div>
            </div>
            <div class="right_part">
                <!--Wybór części pancerza-->
                <div class="param">
                    <input class="readonly_input" type="text" value="Osłona" readonly>
                    <select name="attr_armor_location">
                        <option value="">-</option>
                        <option value="head">Głowy</option>
                        <option value="body">Korpusu</option>
                        <option value="hands">Rąk</option>
                        <option value="legs">Nóg</option>
                    </select>
                </div>
                <!--Wyciągnięcie zmiennej, aby mogła wyświetlać odpowiednią liczbę modyfikacji-->
                <input name="attr_armor_quality" type="hidden" class="sheet-block-mod-switch">
                <!--Modyfikacja 1-->
                <div class="block_mod_1">
                    <input class="block_name" type="text" name="attr_armor_mod_name_1">
                    <textarea class="small_ta" name="attr_armor_mod_desc_1"></textarea>
                </div>
                <!--Modyfikacja 2-->
                <div class="block_mod_2">
                    <input class="block_name" type="text" name="attr_armor_mod_name_2">
                    <textarea class="small_ta" name="attr_armor_mod_desc_2"></textarea>
                </div>
            </div>
        </div>
    </div>
</div>
<!--Strona na pozostałe szczegóły-->
<div class="sheet-details">
    <!--Opis postaci-->
    <div class="sector">
        <h3>Opis postaci</h3>
        <div class="sub_sector">
            Opis<textarea id="tx_desc" name="attr_description"></textarea>
        </div>
        <div class="sub_sector">
            Historia<textarea id="tx_hist" name="attr_history"></textarea>
        </div>
        <div class="sub_sector">
            Dlaczego zostałeś wskrzeszony?<textarea id="tx_res" name="attr_resurection"></textarea>
        </div>
    </div>
    <div class="sector" id="sec_two_part">
        <!--Notatki-->
        <div class="sector" id="sec_notes">
            <div class="sub_sector">
                <h3>Notatki</h3>
                <textarea id="tx_nt" name="attr_notes"></textarea>
            </div>
        </div>
        <!--Opis ducha-->
        <div class="sector" id="sec_ghost">
            <h3>Duch</h3>
            <div class="sub_sector">
                Imię<input type="text" name="attr_ghost_name">
            </div>
            <div class="sub_sector">
                Opis<textarea id="tx_gd" name="attr_ghost_desc"></textarea>
            </div>
            <div class="sub_sector">
                Charakter<input type="text" name="attr_ghost_nature1">
            </div>
            <div class="center_sub_sector">
                <input type="text" name="attr_ghost_nature2">
            </div>
            <div class="sub_sector">
                Rany<input class="short_input" type="text" name="attr_ghost_wounds">
            </div>
            <div class="sub_sector">
                Wytrzymałość<input class="short_input" type="text" name="attr_ghost_tough">
            </div>
            <div class="sub_sector">
                Baza danych<select class="short_select" name="attr_data_base" value="d4">
                    <option value="d4">k4</option>
                    <option value="d6">k6</option>
                    <option value="d8">k8</option>
                    <option value="d10">k10</option>
                    <option value="d12">k12</option>
                </select>
                <input type="hidden" name="attr_data_base_mod" value="0">
                <button type="action" class="roll_button" name="act_roll_data_base"></button><br>
            </div>
            <div class="sub_sector">
                Łączność<select class="short_select" name="attr_connection" value="d4">
                    <option value="d4">k4</option>
                    <option value="d6">k6</option>
                    <option value="d8">k8</option>
                    <option value="d10">k10</option>
                    <option value="d12">k12</option>
                </select>
                <input type="hidden" name="attr_connection_mod" value="0">
                <button type="action" class="roll_button" name="act_roll_connection"></button><br>
            </div>
            <div class="sub_sector">
                Skanowanie<select class="short_select" name="attr_scan" value="d4">
                    <option value="d4">k4</option>
                    <option value="d6">k6</option>
                    <option value="d8">k8</option>
                    <option value="d10">k10</option>
                    <option value="d12">k12</option>
                </select>
                <input type="hidden" name="attr_scan_mod" value="0">
                <button type="action" class="roll_button" name="act_roll_scan"></button><br>
            </div>
            <input type="hidden" name="attr_ghost_figure" value="0">
            <!--Przewagi Ducha-->
            <div id="ghost_Advances" class="inner_sector">
                <h3>Przewagi</h3>
                <div class="sub_sector">
                    <div>
                        <fieldset class="repeating_gadvantage">
                            <div class="sub_sector">
                                Nazwa<input type="text" name="attr_gadvname"><br>
                            </div>
                            <div class="sub_sector">
                                Wymagania
                            </div>
                            <div class="sub_sector">
                                <input type="text" name="attr_gadvreq"><br>
                            </div>
                            <details>
                                Opis<br><textarea class="extending_desc" name="attr_gadvdiscDetails"></textarea>
                            </details>
                        </fieldset>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--Atrybuty Debug-->
    <input type="number" name="attr_EXP">
    <input type="text" name="attr_DEBUG">
    <input type="text" name="attr_DEBUG2">
    <input type="text" name="attr_DEBUG3">
</div>

<rolltemplate class="sheet-rolltemplate-BasicDiceRoll">
    <div class="sheet-template-container">
        <div class="sheet-template-header">{{name}}</div>
        <div class="sheet-results">
            <div class="sheet-template-row">
                <span>Kość główna = {{wynik}}</span>
            </div>
            <div class="sheet-template-row">
                <span>Kość figury = {{pomoc}}</span>
            </div>
            {{#rollGreater() computed::wynik 3}}
            <div class="sheet-template-row-won">
                <span>Test zdany</span>
            </div>
            {{/rollGreater() computed::wynik 3}}
            {{#rollLess() computed::wynik 4}}
            <div class="sheet-template-row-lost">
                <span>Test niezdany</span>
            </div>
            {{/rollLess() computed::wynik 4}}
        </div>
    </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-NoFigureDiceRoll">
    <div class="sheet-template-container">
        <div class="sheet-template-header">{{name}}</div>
        <div class="sheet-results">
            <div class="sheet-template-row">
                <span>Kość główna = {{wynik}}</span>
            </div>
            {{#rollGreater() computed::wynik 3}}
            <div class="sheet-template-row-won">
                <span>Test zdany</span>
            </div>
            {{/rollGreater() computed::wynik 3}}
            {{#rollLess() computed::wynik 4}}
            <div class="sheet-template-row-lost">
                <span>Test niezdany</span>
            </div>
            {{/rollLess() computed::wynik 4}}
        </div>
    </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-Attack">
    <div class="sheet-template-container">
        <div class="sheet-template-header">{{name}}</div>
        <div class="sheet-results">
            <div class="sheet-template-row">
                <span>Kość główna = {{wynik}}</span>
            </div>
            <div class="sheet-template-row">
                <span>Kość figury = {{pomoc}}</span>
            </div>
            {{#rollGreater() computed::wynik 3}}
            <div class="sheet-template-row-won">
                <h3>Trafienie!</h3>
                <div class="sheet-template-row">
                    <span>Obrażenia = {{Obr}}</span>
                </div>
                <div class="sheet-template-row">
                    <span>Kość figury = {{FObr}}</span>
                </div>
            </div>
            {{/rollGreater() computed::wynik 3}}
            {{#rollLess() computed::wynik 4}}
            <div class="sheet-template-row-lost">
                <h3>Pudło!</h3>
            </div>
            {{/rollLess() computed::wynik 4}}
        </div>
    </div>
</rolltemplate>

<script type="text/worker">
    //Przełączanie się między stronami
    const buttonlist = ["main","equipment","details"];
    buttonlist.forEach(button => {
        on(`clicked:${button}`, function() {
            setAttrs({
                sheetTab: button
            });
        });
    });

    //Walidacja podklasy
    on("change:subclass", function(){
        getAttrs(["class","subclass"], function(values){
            var clas=values.class;    
            var sub_clas=values.subclass;
            if(clas == "Tytan"){
                if(sub_clas!="Słoneczny pogromca" && sub_clas!="Szturmowiec" && sub_clas!="Wartownik"){
                    setAttrs({subclass: "-"});
                }
            }else if(clas =="Łowca"){
                if(sub_clas!="Strzelec" && sub_clas!="Gromodzierżca" && sub_clas!="Tropiciel"){
                    setAttrs({subclass: "-"});
                }
            }else if(clas == "Czarownik"){
                if(sub_clas!="Ostrze świtu" && sub_clas!="Kroczący przez próżnię" && sub_clas!="Siewca burz"){
                    setAttrs({subclass: "-"});
                }
            }
        })
    })

    //Zmiana liczby doświadczenia
    on("change:EXP", function(){
        getAttrs(["EXP","level"], function(values){
            var exp=values.EXP;
            //Pierw ile expa brakuje, dalej jaki level
            setAttrs({
                EXP_To_Next_Level:exp%5,
                level: parseInt(exp/5)
            });
            var lv=values.level;
            if(lv<9){
                setAttrs({rank: "Nowicjusz"});
            }else if(lv<17){
                setAttrs({rank: "Doświadczony"});
            }else if(lv<25){
                setAttrs({rank: "Weteran"});
            }else if(lv<33){
                setAttrs({rank: "Heros"});
            }else{
                setAttrs({rank: "Legenda"});
            }
        })
    })

    //Usuwa przedrostek z nazwy kości
    function dice_max_value(dice){
        var value=dice.slice(1)
        return value!=""?value:0
    }

    //Sprawdzanie czy rasa Przebudzonych ma odpowiednią wartość ducha
    on("change:spirit change:race",function(){
        getAttrs(["spirit","race"],function(values){
            var race=values.race
            var spirit=values.spirit
            if(race=="Przebudzony" && spirit=="d4"){
                setAttrs({spirit: "d6"})
            }
        })
    })

    //Sprawdzanie czy aktualna wartość fuksów nie jest za duża
    on("change:luck",function(){
        getAttrs(["luck_max","luck"],function(values){
            var max_luck=values.luck_max
            var luck=values.luck
            if(luck<0){
                setAttrs({luck: 0}) 
            }else if(luck>max_luck){
                setAttrs({luck: max_luck}) 
            }
        })
    })

    //Obliczanie wytrzymałości
    on("change:vigor change:tough_mod", function(){
        getAttrs(["vigor","tough_mod","size"], function(values){
            var vigor=parseInt(dice_max_value(values.vigor))    //Parsowanie
            var tm=parseInt(values.tough_mod)
            var size=parseInt(values.size)

            vigor=vigor/2+tm+size+2                             //Dodanie modyfikatorów
            setAttrs({tough: vigor})                            //ustawienie wytrzymałości
        })
    })

    //Obliczanie obrony
    on("change:brawl change:parry_mod", function(){
        getAttrs(["brawl","parry_mod"], function(values){
            var parry=parseInt(dice_max_value(values.brawl))    //Parsowanie
            var pm=parseInt(values.parry_mod)

            parry=parry/2+pm+2                                  //Dodanie modyfikatorów
            setAttrs({parry: parry})                            //ustawienie wytrzymałości
        })
    })

    //Funkcja służąca do podpinania rzutu do przycisku
    function bind_roll(attribute_name,attribute){
        var query="&{template:BasicDiceRoll} "                                                          //Szablon rzutu
        query=query.concat("{{name=@{name} wykonuje test "+attribute_name+"}} ")                        //Nazwa rzutu

        getAttrs([attribute], function(values){
            var atr=values[attribute]
            //Sprawdzenie czy umiejętność jest wykupiona
            if(atr!="-"){
                query=query.concat("{{wynik=[[@{"+attribute+"}! +@{"+attribute+"_mod} +?{Modyfikator|0}]]}} ")    //Rzut kością główną
                query=query.concat("{{pomoc=[[d6! +@{"+attribute+"_mod} +?{Modyfikator|0}]]}}")                   //Rzut kością figury
            }else{
                query=query.concat("{{wynik=[[d4!-2 +@{"+attribute+"_mod} +?{Modyfikator|0}]]}}")             //Rzut kością główną
                query=query.concat("{{pomoc=[[d6!-2 +@{"+attribute+"_mod} +?{Modyfikator|0}]]}}")             //Rzut kością figury
            }

            startRoll(query, (results) => {
                var basicDice = results.results.wynik.result    //Kość główna
                var figDice = results.results.pomoc.result      //Kość figury
                var resDice                                     //Kość wyniku
                //Jeśli kość główna nie jest równa jeden i figury jest większa, to zamień
                if(basicDice>1 && figDice>basicDice){
                    resDice=figDice
                }else{
                    resDice=basicDice
                }
                finishRoll(
                    results.rollId,
                    {
                        wynik: resDice
                    }
                )
            })
        })
    }

    //Funkcja służąca do podpinania rzutu do przycisku dla dodanych umiejętności
    function bind_roll_new(attribute_name,attribute){
        attribute_name="repeating_newskill_"+attribute_name         //Nazwa umiejętności
        attribute="repeating_newskill_"+attribute                   //Wartość umiejętności
        attribute_mod=attribute+"mod"                               //Modyfikator umiejętności
        var query="&{template:BasicDiceRoll} "                      //Szablon rzutu

        getAttrs([attribute,attribute_name,attribute_mod], function(values){
            var name=values[attribute_name]             //Nazwa umiejętności
            var atr=values[attribute]                   //Wartość umiejętności
            var mod=values[attribute_mod]               //Modyfikator umiejętności
            query=query.concat("{{name=@{name} wykonuje test "+name+"}} ")                        //Nazwa rzutu
            //Sprawdzenie czy umiejętność jest wykupiona
            if(atr!="-"){             
                query=query.concat("{{wynik=[["+atr+"! +"+mod+" +?{Modyfikator|0}]]}}")          //Rzut kością główną
                query=query.concat("{{pomoc=[[d6! +"+mod+" +?{Modyfikator|0}]]}}")               //Rzut kością figury
            }else{
                query=query.concat("{{wynik=[[d4!-2 +"+mod+" +?{Modyfikator|0}]]}}")             //Rzut kością główną
                query=query.concat("{{pomoc=[[d6!-2 +"+mod+" +?{Modyfikator|0}]]}}")             //Rzut kością figury
            }
    
            startRoll(query, (results) => {
                var basicDice = results.results.wynik.result    //Kość główna
                var figDice = results.results.pomoc.result      //Kość figury
                var resDice                                     //Kość wyniku
    
                //Jeśli kość główna nie jest równa jeden i figury jest większa, to zamień
                if(basicDice>1 && figDice>basicDice){
                    resDice=figDice
                }else{
                    resDice=basicDice
                }
                finishRoll(
                    results.rollId,
                    {
                        wynik: resDice
                    }
                )
            })
        })
    }

    //Funkcja służąca do podpinania rzutu dla umiejętności ducha
    function bind_roll_ghost(attribute_name,attribute){
        getAttrs([attribute,"ghost_figure"], function(values){
            if(!values.ghost_figure){
                bind_roll(attribute_name,attribute)                         //Jeśli figura, to potraktuj jak umiejętnośc gracza
                return
            }
            var query="&{template:NoFigureDiceRoll} "                                                      //Szablon rzutu
            query=query.concat("{{name=@{name} wykonuje test "+attribute_name+"}} ")                        //Nazwa rzutu
            var atr=values[attribute]
            query=query.concat("{{wynik=[[@{"+attribute+"}! +@{"+attribute+"_mod} +?{Modyfikator|0}]]}} ")    //Rzut kością główną

            startRoll(query, (results) => {
                var basicDice = results.results.wynik.result    //Kość główna
                finishRoll(
                results.rollId,
                    {
                        wynik: basicDice
                    }
                )
            })
        })
    }

    //Przypisanie rzutów do cech
    on('clicked:roll_strength', (info) => {
        bind_roll("siły","strength")
    })

    on('clicked:roll_agility', (info) => {
        bind_roll("zręczności","agility")
    })

    on('clicked:roll_smart', (info) => {
        bind_roll("sprytu","smart")
    })

    on('clicked:roll_spirit', (info) => {
        bind_roll("ducha","spirit")
    })

    on('clicked:roll_vigor', (info) => {
        bind_roll("wigoru","vigor")
    })

    //Przypisanie rzutów do umiejętności
    on('clicked:roll_gamble', (info) => {
        bind_roll("hazardu","gamble")
    })

    on('clicked:roll_survival', (info) => {
        bind_roll("przetrwania","survival")
    })
    
    on('clicked:roll_repair', (info) => {
        bind_roll("reperowania","repair")
    })

    on('clicked:roll_spot', (info) => {
        bind_roll("spostrzegawczości","spot")
    })

    on('clicked:roll_tracking', (info) => {
        bind_roll("tropienia","tracking")
    })

    on('clicked:roll_search', (info) => {
        bind_roll("wyszukiwania","search")
    })

    on('clicked:roll_ridicule', (info) => {
        bind_roll("wyśmiewania","ridicule")
    })

    on('clicked:roll_pilotage', (info) => {
        bind_roll("pilotowania","pilotage")
    })

    on('clicked:roll_drive', (info) => {
        bind_roll("prowadzenia","drive")
    })

    on('clicked:roll_move', (info) => {
        bind_roll("ruchu","move")
    })

    on('clicked:roll_throw', (info) => {
        bind_roll("rzucania","throw")
    })

    on('clicked:roll_stealth', (info) => {
        bind_roll("skradania się","stealth")
    })

    on('clicked:roll_shoot', (info) => {
        bind_roll("strzelania","shoot")
    })

    on('clicked:roll_brawl', (info) => {
        bind_roll("walki wręcz","brawl")
    })

    on('clicked:roll_breaking', (info) => {
        bind_roll("włamywania się","breaking")
    })

    on('clicked:roll_persuade', (info) => {
        bind_roll("przekonywania","persuade")
    })

    on('clicked:roll_intimidate', (info) => {
        bind_roll("zastraszania","intimidate")
    })

    //Umiejętności dodatkowe
    on('clicked:repeating_newskill:rollns', (info) => {
        bind_roll_new("nsname","nsvalue")
    })

    //Umiejętności ducha
    on('clicked:roll_data_base', (info) => {
        bind_roll_ghost("bazy danych","data_base")
    })

    on('clicked:roll_connection', (info) => {
        bind_roll_ghost("łączności","connection")
    })

    on('clicked:roll_scan', (info) => {
        bind_roll_ghost("skanowania","scan")
    })

    //Typowe bronie
    const gun_atr=["Obrażenia","Zasięg","Stabilność","Szybkostrzelność","Magazynek","Przeładowanie","Dobycie"]
    const guns=["Hand_cannon","Auto_rifle","Scout_rifle","Pulse_rifle","Sidearm","Smg","Shotgun","Sniper_rifle","Fusion_rifle","Machine_rifle","Line_rifle"]
    
    const bows=["Obrażenia","Zasięg", "Stabilność", "Szybkostrzelność", "Pełny naciąg", "Bonus za celowanie", "Dobycie"]
    const light_g=["Obrażenia","Zasięg", "Stabilność","Szybkostrzelność", "Promień wybuchu", "Elastyczność", "Dobycie"]
    const rocket_l=["Obrażenia","Zasięg", "Naprowadzanie", "Promień wybuchu", "Magazynek", "Przeładowanie","Dobycie"]
    const granade_l=["Obrażenia","Zasięg", "Stabilność", "Promień wybuchu", "Magazynek", "Przeładowanie","Dobycie"]
    const swords=["Obrażenia","Siła osłony", "Wydajność","Szybkość", "Magazynek", "Zasięg tąpnięcia", "Dobycie"]

    const gun_dict={
        Hand_cannon: gun_atr,
        Auto_rifle: gun_atr,
        Scout_rifle: gun_atr,
        Pulse_rifle: gun_atr,
        Sidearm: gun_atr,
        Smg: gun_atr,
        Shotgun: gun_atr,
        Sniper_rifle: gun_atr,
        Fusion_rifle: gun_atr,
        Machine_rifle: gun_atr,
        Line_rifle: gun_atr,
        //Bronie o nietypowej charakterystyce
        Bow: bows,
        Light_grnd: light_g,
        Sword: swords,
        Granade_launcher: granade_l,
        Rocket_launcher: rocket_l
    }
    
    on("change:type", function(){
        getAttrs(["type"], function(values){
            var type=values.type
            var parameters=gun_dict[type]
            setAttrs({
                param_name_1: parameters[0],
                param_name_2: parameters[1],
                param_name_3: parameters[2],
                param_name_4: parameters[3],
                param_name_5: parameters[4],
                param_name_6: parameters[5],
                param_name_7: parameters[6]
            })
        })
    })

    //Kontrola amunicji
    //Zmiana w magazynku
    on("change:weapon_current_ammo change:param5",function(){
        getAttrs(["type","weapon_current_ammo","param5","kinetic_amno","special_amno","heavy_amno","weapon_amno"], function(values){
            var type=values.type
            var amno=parseInt(values.weapon_current_ammo)
            var mag=parseInt(values.param5)
            var weap_amno=values.weapon_amno
            if(type=="Sword"){
                let amno_pack_size=mag/5                      //Wielkość paczki z amunicją
                let rest_amno=Math.floor(amno/amno_pack_size)  //Ile całych paczek zostało
                setAttrs({
                    heavy_amno:rest_amno                    //Zmiana żetonów z amunicją
                })
            }if(type=="Light_grnd"){
                let rest_amno=Math.floor(amno/2)               //Ile całych paczek zostało
                let amno_type=parseInt(values[weap_amno])   //Używany typ amunicji
                
                setAttrs({
                    [weap_amno]:rest_amno
                })
            }else if(type=="Bow"){
                let rest_amno=Math.floor(amno/6)               //Ile całych paczek zostało
                let amno_type=parseInt(values[weap_amno])
                
                setAttrs({
                    [weap_amno]:rest_amno                   //Zmiana żetonów z amunicją
                })
            }else{
                if(amno>mag){
                    setAttrs({
                        weapon_current_ammo:mag               //Zmiana żetonów z amunicją
                    })
                }
            }
        })
    })

    //Zmiana w żetonach
    on("change:type change:kinetic_amno change:special_amno change:heavy_amno",function(){
        getAttrs(["type","weapon_current_ammo","param5","kinetic_amno","special_amno","heavy_amno","weapon_amno"], function(values){
            var type=values.type
            var amno=parseInt(values.weapon_current_ammo)
            var mag=parseInt(values.param5)
            var weap_amno=values.weapon_amno
            if(type=="Sword"){
                let amno_pack_size=mag/5                        //wielkość paczki z amunicją
                let rest=amno%amno_pack_size                    //Ile nabojów zostało poza paczkami
                let amno_type=parseInt(values.heavy_amno)
                let curr_amno=amno_type*amno_pack_size+rest     //Ile nabojów jest obecnie dostępnych
                curr_amno=curr_amno>mag?mag:curr_amno
                setAttrs({
                    weapon_current_ammo:curr_amno
                })
            }if(type=="Light_grnd"){
                let rest=amno%2                                  //Ile nabojów zostało poza paczkami
                let amno_type=parseInt(values[weap_amno])
                let curr_amno=amno_type*2+rest
                curr_amno=curr_amno>20?20:curr_amno             //Ile nabojów jest obecnie dostępnych
                setAttrs({
                    weapon_current_ammo:curr_amno
                })
            }else if(type=="Bow"){
                let rest=amno%6                                  //Ile nabojów zostało poza paczkami
                let amno_type=parseInt(values[weap_amno])
                let curr_amno=amno_type*6+rest
                curr_amno=curr_amno>60?60:curr_amno             //Ile nabojów jest obecnie dostępnych
                setAttrs({
                    weapon_current_ammo:curr_amno
                })
            }
        })
    })
    //Maksymalna wartość cechy dla pancerza danej jakości
    const armor_max={
        none: "0",
        common: "2",
        uncommon: "3",
        rare: "4",
        legend: "5",
        exotic: "5"
    }

    //Obsługa pancerza
    function check_armor(atribute,quality){
        getAttrs([atribute,quality],function(values){
            var atr=values[atribute]
            var qual=values[quality]
            //Zamień na wartość ze słownika
            qual=qual=="-"?"none":qual
            //Czy jest puste?
            if(isNaN(atr)){
                setAttrs({
                    [atribute]: "0"
                })
                return
            }
            //Sprawdź jakość
            if(atr>armor_max[qual]){
                //Zmień
                setAttrs({
                    [atribute]: "0"
                })
            }
        })
    }

    //Maksymalna wartość opancerzenie dla danej jakości
    const armor={
        none: "0",
        common: "1",
        uncommon: "2",
        rare: "3",
        legend: "4",
        exotic: "5"
    }
    //Parametry pancerza
    const armor_param=["armor_mobility","armor_defence","armor_regeneration","armor_discipline","armor_inteligence","armor_strong"]
    //Sprawdź wartości pancerza
    on("change:armor_mobility change:armor_defence change:armor_regeneration change:armor_discipline change:armor_inteligence change:armor_strong change:armor_value change:armor_quality", function(){
        //Wywołaj spawdzenie dla każdej cechy
        armor_param.forEach(arm =>{
            check_armor(arm,"armor_quality")
        })
        //Sprawdź wartości opancerzenia
        getAttrs(["armor_quality","armor_value"],function(values){
            var qual=values.armor_quality
            qual=qual=="-"?"none":qual
            var val=values.armor_value
            //Sprawdź wartość opancerzenia
            if(qual=="common"){
                if(val!="0" && val!="1"){
                    setAttrs({
                        armor_value: "0"
                    })
                }
            }else{
                if(val!=armor[qual]){
                    setAttrs({
                        armor_value: armor[qual]
                    })
                }
            }
        })
    })

    //Funkcja służąca do podpinania ataku
    function bind_atack(attribute_name,attribute,wp_name,damage,series=1){
        var query="&{template:Attack} "                                                                       //Szablon rzutu
        query=query.concat("{{name=@{name} wykonuje atak za pomocą @{"+wp_name+"}}} ")                        //Nazwa rzutu

        getAttrs([attribute,damage,"weapon_current_ammo"], function(values){
            var atr=values[attribute]
            var camno=parseInt(values.weapon_current_ammo)      //Obecna amunicja
            //Czy broń jest naładowana?
            if(camno==0){
                throw new Error("Brak amunicji!")
            }else{
                //Odejmij amunicje
                setAttrs({
                    weapon_current_ammo: camno-series
                })
            }
            //Sprawdzenie czy umiejętność jest wykupiona
            if(atr!="-"){
                query=query.concat("{{wynik=[[@{"+attribute+"}! +@{"+attribute+"_mod} +?{Modyfikator|0}]]}} ")    //Rzut kością główną
                query=query.concat("{{pomoc=[[d6! +@{"+attribute+"_mod} +?{Modyfikator|0}]]}}")                   //Rzut kością figury
            }else{
                query=query.concat("{{wynik=[[d4!-2 +@{"+attribute+"_mod} +?{Modyfikator|0}]]}}")             //Rzut kością główną
                query=query.concat("{{pomoc=[[d6!-2 +@{"+attribute+"_mod} +?{Modyfikator|0}]]}}")             //Rzut kością figury
            }
            //Czy broń atakuję serią
            if(series!=1){
                //Skomplikowane
                if(/*values[damage].search("+")!=-1*/false){
                //TODO
                }else{
                    query=query.concat("{{Obr=[[[[d"+series+"]]@{"+damage+"}!]] }}")
                }
            //Jeśli nie
            }else{
                query=query.concat("{{Obr=[[@{"+damage+"}! ]]}}")
            }
            query=query.concat("{{FObr=[[d6!]]}}")

            startRoll(query, (results) => {
                var basicDice = results.results.wynik.result    //Kość główna
                var figDice = results.results.pomoc.result      //Kość figury
                var resDice                                     //Kość wyniku

                //Jeśli kość główna nie jest równa jeden i figury jest większa, to zamień
                if(basicDice>1 && figDice>basicDice){
                    resDice=figDice
                }else{
                    resDice=basicDice
                }
                finishRoll(
                    results.rollId,
                    {
                        wynik: resDice
                    }
                )
            })
        })
    }

    //Przyciski na karcie broni
    on('clicked:attack', (info) => {
        getAttrs(["type","param4"],function(values){
            var type=values.type       //Typ broni
            var rate=values.param4     //Szybkostrzelność
            //Sprawdź typ broni
            if(type=="Sword"){          //Miecz wykorzystuję inny rzut
                bind_atack("walki wręcz","brawl","weapon_name","param1")
            }else if(type=="Rocket_launcher" || type=="Granade_launcher"){  //Bronie bez cechy szybkostrzelność
                bind_atack("strzelania","shoot","weapon_name","param1")
            }else{
                //Sprawdzenie czy broń strzela serią
                if(rate[0]=='s'){
                    bind_atack("strzelania","shoot","weapon_name","param1",series=parseInt(rate.slice(1)))
                }else{
                    bind_atack("strzelania","shoot","weapon_name","param1")
                }
            }
        })
    })

    //Obsługa przycisku przeładuj
    on('clicked:reload', (info) => {
        getAttrs(["type","weapon_current_ammo","weapon_amno","param5","kinetic_amno","special_amno","heavy_amno"],function(values){
            var type=values.type       //Typ broni
            //Broni któych się nie przeładowuje lub nie mają magazynka
            if(type=="Sword" || type=="Light_grnd" || type=="Bow"){
                return
            }
            //1 żeton=1 magazynek
            if(type=="Hand_cannon" || type=="Auto_rifle" || type=="Scout_rifle" || type=="Pulse_rifle" || type=="Sidearm" || type=="Smg"){
                var at=values.weapon_amno                           //Typ amunicji
                var amno=parseInt(values[at])                     //Ile żetonów pozostało
                var max=parseInt(values.param5)                   //Wielkość magazynka
                var camno=parseInt(values.weapon_current_ammo)    //Obecna amunicja
                //Zmień wartość amunicji
                if(amno!=0  && camno!=max){
                    setAttrs({
                        weapon_current_ammo: max,
                        [at]: amno-1
                    })
                }
            //2 żetony=1 magazynek
            }else if(type=="Shotgun" || type=="Sniper_rifle" || type=="Fusion_rifle" || type=="Machine_rifle" || type=="Line_rifle" || type=="Granade_launcher"){
                var at=values.weapon_amno                           //Typ amunicji
                var amno=parseInt(values[at])                     //Ile żetonów pozostało
                var max=parseInt(values.param5)                   //Wielkość magazynka
                var camno=parseInt(values.weapon_current_ammo)    //Obecna amunicja
                //Zmień wartość amunicji
                if(amno>1 && camno!=max){
                    setAttrs({
                        weapon_current_ammo: max,
                        [at]: amno-2
                    })
                }else if(amno==1 && camno!=max){
                    setAttrs({
                        weapon_current_ammo: Math.floor(max/2),
                        [at]: amno-1
                    })
                }
            //1 żeton=1 pocisk //Wyrzutnia rakiet
            }else{
                var at=values.weapon_amno                           //Typ amunicji
                var amno=parseInt(values[at])                     //Ile żetonów pozostało
                var max=parseInt(values.param5)                   //Wielkość magazynka
                var camno=parseInt(values.weapon_current_ammo)    //Obecna amunicja
                //Zmień wartość amunicji
                if(amno>=max && camno!=max){
                    setAttrs({
                        weapon_current_ammo: max,
                        [at]: amno-max
                    })
                }else if(amno>0 && camno!=max){
                    setAttrs({
                        weapon_current_ammo: amno,
                        [at]: 0
                    })
                }
            }
        })
    })
</script>